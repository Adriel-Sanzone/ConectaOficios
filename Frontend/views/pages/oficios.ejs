<!DOCTYPE html>
<html lang="en">


<head>
  <%- include ('../partials/head') %>
  <link rel="stylesheet" href="/Frontend/css/oficios.css">
</head>

<body>

  <%- include ('../partials/header') %>

  <div class="container">
    <div class="row">
      <div class="col-md-3">
        <div class="categorias">
          <p>Categorías</p>
          <% especializacion.forEach(function(c){ %>
            <div class="categoria <%=c.especializacion%>">
              <input data-id="<%= c.id %>"  class="checkbox-especializacion" type="checkbox" id="checkbox-<%= c.id %>" >
              <label for="checkbox-<%= c.id %>"><%= c.especializacion %></label>
            </div>
          <% }) %>
          
        </div>
      </div>
      <div class="col-md-9">
        <div class="personas" >
          <!---Llamo a los trabajadores destacados-->
          <% usuariosEsp.forEach(function(c){ %>
            <% var especializacionesTexto = ''; %>
            <% c.especializaciones.forEach(function(e){ %>
              <% especializacionesTexto =+ e.id_especializacion+',' %>
            <% }) %>
            <div class="persona " data-especializacion="<%=  especializacionesTexto.substring(0, especializacionesTexto.length - 1); %>">
              <div class="row">
                <div class="col-md-3">
                  <div class="imagen">
                    <% if(c.path != ""){ %>
                    <div class="imagen-container">
                      <img class="img-fluid" src="<%= c.path %>">
                    </div>
                    <% } else {; %>
                    <div class="imagen-container">
                      <img class="img-fluid" src="Frontend/img/usuario-sin-foto.png">
                    </div>                            
                    <% }; %>
                  </div>
                </div>
                <div class="col-md-9">
                  <div class="info-persona">
                    <% c.especializaciones.forEach(function(e){ %>
                      <div class="especialidades">
                        <h4>Agua</h4>
                        <h3><%= e.nombre %></h3>
                      </div>
                    <% }) %>
                    <a href="/perfil/<%=c.id%>"><%= c.nombre %> <%= c.apellido %></a>
                    <div class="descripcion">
                      <p><%= c.descripcion %></p>
                    </div>
                    <div class="ubicacion">
                      <i class="fa-solid fa-location-dot"></i>
                      <p><%= c.direccion %></p>
                    </div>
                    <button><%= c.contacto %> <i class="fab fa-whatsapp"></i></button>
                  </div>
                </div>
              </div>
            </div>
          <% }) %>
          <!---Llamo a los trabajadores NO destacados-->
        </div>

      </div>
    </div>

  </div>

  <%- include ('../partials/footer') %>

  <script src="/Frontend/js/script.js"></script>
  <script type="text/javascript">

    $(document).ready(function() {
      // Obtengo todas las casillas de verificación
      const checkboxes = document.querySelectorAll('.checkbox-especializacion');

      checkboxes.forEach(checkbox => {
        checkbox.addEventListener('change', () => {

          var checkedElements = new Array();
          $('.checkbox-especializacion:checked').each(function(i, e){
            checkedElements.push($(e).attr('data-id'))

          });

          if (checkedElements.length == 0) {
            $('.persona').show();
            return false;
          }

          $('.persona').each(function(i, e){
            var especializacion = $(e).attr('data-especializacion');
            
            var ArrayEspecializaciones = especializacion.split(',');

            var contador = 0;
            ArrayEspecializaciones.forEach(function(id_especializacion){
              if (checkedElements.includes(id_especializacion)) {
                contador++;
              }
            });

            if (contador == 0) {
              $(e).hide();
            } else {
              $(e).show();
            }
          });
        });
      });
    });
  </script>

</body>

</html>